INSERT INTO `T_WEB_METRIC_TEMPLATE` (`TEMPLATE_ID`, `TEMPLATE_NAME`, `TEMPLATE_CONTENT`, `TEMPLATE_SCRIPT`, `IS_VALID`) VALUES (1, '主机状态检查明细', NULL, 'var colorOk=\'${config.COLOR_OK}\',colorNormal=\'${config.COLOR_NORMAL}\',colorWarn=\'${config.COLOR_WARN}\',colorError=\'${config.COLOR_ERROR}\',datas = eval(\'${hostStatus.metrics}\');\r\nif (!isArray(datas) || datas.length == 0 || !datas[0].value){\r\n    divMetric.html(\'<label>加载失败！</label>\');\r\n    return;\r\n}\r\ndatas = datas[0].value;\r\nvar pageSize=5;\r\ndivMetric.datagrid({\r\n    //title:\'${title}\',\r\n    fitColumns: true,\r\n    rownumbers: true,\r\n    singleSelect: true,\r\n    remoteSort:false,\r\n    sortName:\"status\",\r\n    sortOrder:\"asc\",\r\n    pagination: pageSize < datas.length,\r\n    pageSize:pageSize,\r\n    pageList: getPageList(pageSize),\r\n    columns:[[\r\n        {field:\'name\',title:\'主机\',align:\'center\',halign:\'center\',sortable:\"true\"},\r\n        {field:\'ip\',title:\'IP\',align:\'center\',halign:\'center\',sortable:\"true\"},\r\n        {field:\'status\',title:\'状态\',align:\'center\',halign:\'center\',sortable:\"true\",styler:function (value,row,index){if (value != \'UP\') return \'background-color:\' + colorError+ \';color:white\';}},\r\n        {field:\'lastCheck\',title:\'最后检查时间\',align:\'center\',halign:\'center\',sortable:\"true\"},\r\n        {field:\'duration\',title:\'运行时长\',align:\'center\',halign:\'center\'},\r\n        {field:\'statusInformation\',title:\'状态信息\',align:\'left\',halign:\'center\'}\r\n    ]],\r\n    data:datas\r\n}).datagrid(\'clientPaging\');', '1');
INSERT INTO `T_WEB_METRIC_TEMPLATE` (`TEMPLATE_ID`, `TEMPLATE_NAME`, `TEMPLATE_CONTENT`, `TEMPLATE_SCRIPT`, `IS_VALID`) VALUES (2, '服务状态检查明细', NULL, 'var colorOk=\'${config.COLOR_OK}\',colorNormal=\'${config.COLOR_NORMAL}\',colorWarn=\'${config.COLOR_WARN}\',colorError=\'${config.COLOR_ERROR}\',hostMetrics = eval(\'${hostService.metrics}\'),datas=[],pageSize=\'${request.pageSize}\',services=\'${request.services}\' == \'\' ? undefined : \'${request.services}\'.split(\",\"),hosts=\'${request.hosts}\' == \'\' ? undefined : \'${request.hosts}\'.split(\",\");\r\nif (!isArray(hostMetrics) || hostMetrics.length == 0 || !hostMetrics[0].value){\r\n    divMetric.html(\'<label>加载失败！</label>\');\r\n    return;\r\n}\r\nhostMetrics = hostMetrics[0].value;\r\nfor(var i=0,iLen=hostMetrics.length;i<iLen;++i){\r\n    var hostMetric = hostMetrics[i];\r\n    if (hosts == undefined || -1 != arrayIndexOf(hosts,hostMetric.name)){\r\n        for(var j=0,jLen=hostMetric.services.length;j<jLen;++j){\r\n            if (services == undefined || -1 != arrayIndexOf(services,hostMetric.services[j].name)){\r\n                hostMetric.services[j].host = hostMetric.name;\r\n                datas.push(hostMetric.services[j]);\r\n            }\r\n        }\r\n    }\r\n}\r\nlog(hostMetrics);log(datas);\r\nif(pageSize != \'\'){\r\n	pageSize=toDecimal(pageSize,0);\r\n	if(isNaN(pageSize)){\r\n		pageSize = 5;\r\n	}\r\n}else{\r\n	pageSize = 5;\r\n}\r\ndivMetric.datagrid({\r\n    //title:\'${title}\',\r\n    fitColumns: true,\r\n    rownumbers: true,\r\n    singleSelect: true,\r\n    remoteSort:false,\r\n    sortName:\"status\",\r\n    sortOrder:\"asc\",\r\n    pagination: pageSize < datas.length,\r\n    pageSize:pageSize,\r\n    pageList: getPageList(pageSize),\r\n    columns:[[\r\n        {field:\'name\',title:\'服务\',align:\'center\',halign:\'center\',sortable:\"true\"},\r\n        {field:\'host\',title:\'主机\',align:\'center\',halign:\'center\',sortable:\"true\"},\r\n        {field:\'status\',title:\'服务状态\',align:\'center\',halign:\'center\',sortable:\"true\",styler:function (value,row,index){if (value != \'OK\') return \'background-color:\' + colorError+ \';color:white\';}},\r\n        {field:\'lastCheck\',title:\'最后检查时间\',align:\'center\',halign:\'center\',sortable:\"true\"},\r\n        {field:\'duration\',title:\'运行时长\',align:\'center\',halign:\'center\'},\r\n        {field:\'statusInformation\',title:\'状态信息\',align:\'left\',halign:\'center\'}\r\n    ]],\r\n    data:datas\r\n}).datagrid(\'clientPaging\');', '1');
INSERT INTO `T_WEB_METRIC_TEMPLATE` (`TEMPLATE_ID`, `TEMPLATE_NAME`, `TEMPLATE_CONTENT`, `TEMPLATE_SCRIPT`, `IS_VALID`) VALUES (3, '主机状态', '', 'var colorOk=\'${config.COLOR_OK}\',colorNormal=\'${config.COLOR_NORMAL}\',colorWarn=\'${config.COLOR_WARN}\',colorError=\'${config.COLOR_ERROR}\',propName=\'${request.propName}\',propTitle=\'${request.propTitle}\',filter=\'${request.filter}\',hostTypes = eval(\'${hostType.metrics}\'),hostStatus = eval(\'${hostStatus.metrics}\');\r\nvar types={},hostMetrics={},datas = [],filters = filter.split(\"|\",2),filterType=filterValue=undefined;\r\nif (!isArray(hostTypes) || hostTypes.length == 0 || !hostTypes[0].value\r\n    || !isArray(hostStatus) || hostStatus.length == 0 || !hostStatus[0].value){\r\n    divMetric.html(\'<label>加载失败！</label>\');\r\n    return;\r\n}\r\nhostTypes = hostTypes[0].value;\r\nhostStatus = hostStatus[0].value;\r\nif (!propName) propName = \'grouptype\';\r\nif (!propTitle) propTitle = \'类型\';\r\nfor(var i=0,iLen=hostStatus.length;i<iLen;++i){\r\n    var aStatus = hostStatus[i];\r\n    if (!hostMetrics[aStatus.name]){\r\n        hostMetrics[aStatus.name] = aStatus;\r\n    }\r\n}\r\n\r\nif (filters.length == 2){\r\n    filterType = filters[0];\r\n    filterValue = filters[1];\r\n}\r\nfor(var i=0,iLen=hostTypes.length;i<iLen;++i){\r\n    var hostType = hostTypes[i];\r\n    if (filterType && filterValue != hostType[filterType]) continue;\r\n    if(!types[hostType[propName]]){\r\n        types[hostType[propName]] = {up:0,down:0,outline:0,name:hostType[propName],hosts:{}};\r\n    }\r\n	// 避免重复计数\r\n	if(types[hostType[propName]][\"hosts\"][hostType.hostname]) continue;\r\n	types[hostType[propName]][\"hosts\"][hostType.hostname] = 1;\r\n    var aStatus = hostMetrics[hostType.hostname];\r\n    if (!aStatus){\r\n        types[hostType[propName]].outline += 1;\r\n    }else if (aStatus.status == \'UP\'){\r\n        types[hostType[propName]].up += 1;\r\n    }else{\r\n        types[hostType[propName]].down += 1;\r\n    }\r\n}\r\n\r\nfor(var propertyName in types){\r\n    datas.push(types[propertyName]);\r\n}\r\n\r\nvar pageSize = 5;\r\ndivMetric.datagrid({\r\n    //title:\'${title}\',\r\n    fitColumns: true,\r\n    rownumbers: true,\r\n    singleSelect: true,\r\n    remoteSort:false,\r\n    sortName:\"down\",\r\n    sortOrder:\"desc\",\r\n    pagination:pageSize < datas.length,\r\n    pageSize:pageSize,\r\n    pageList: getPageList(pageSize),\r\n    columns:[[\r\n        {field:\'name\',title:propTitle,align:\'center\',halign:\'center\',sortable:\"true\"},\r\n        {field:\'up\',title:\'在线数\',align:\'center\',halign:\'center\',sortable:\"true\"},\r\n        {field:\'down\',title:\'宕机数\',align:\'center\',halign:\'center\',sortable:\"true\",styler:function (value,row,index){if (value) return \'background-color:\' + colorError+ \';color:white\';}},\r\n        {field:\'outline\',title:\'手工下线数\',align:\'center\',halign:\'center\',sortable:\"true\",styler:function (value,row,index){if (value) return \'background-color:\' + colorNormal+ \';color:white\';}}\r\n    ]],\r\n    data:datas\r\n}).datagrid(\'clientPaging\');', '1');
INSERT INTO `T_WEB_METRIC_TEMPLATE` (`TEMPLATE_ID`, `TEMPLATE_NAME`, `TEMPLATE_CONTENT`, `TEMPLATE_SCRIPT`, `IS_VALID`) VALUES (4, '主机服务状态列表', NULL, 'var colorOk=\'${config.COLOR_OK}\',colorNormal=\'${config.COLOR_NORMAL}\',colorWarn=\'${config.COLOR_WARN}\',colorError=\'${config.COLOR_ERROR}\',filter=\'${request.filter}\',hostTypes = eval(\'${hostType.metrics}\'),hostMetrics = eval(\'${hostService.metrics}\'),metrics=[];\r\nvar filters = filter.split(\"|\",2),realHosts=filterType=filterValue=undefined;\r\nif (!isArray(hostTypes) || hostTypes.length == 0 || !hostTypes[0].value\r\n    || !isArray(hostMetrics) || hostMetrics.length == 0 || !hostMetrics[0].value){\r\n    divMetric.html(\'<label>加载失败！</label>\');\r\n    return;\r\n}\r\nhostTypes = hostTypes[0].value;\r\nhostMetrics = hostMetrics[0].value;\r\nif (filters.length == 2){\r\n    filterType = filters[0];\r\n    filterValue = filters[1];\r\n	realHosts = {};\r\n	for(var i=0,iLen=hostTypes.length;i<iLen;++i){\r\n		var hostType = hostTypes[i];\r\n		if (filterType && filterValue != hostType[filterType]) continue;\r\n		realHosts[hostType.hostname] = 1;\r\n	}\r\n}\r\n\r\nfor(var i=0,iLen=hostMetrics.length;i<iLen;++i){\r\n    var hostMetric = hostMetrics[i],ok=0,error=0;\r\n	if (realHosts && !realHosts[hostMetric.name]) continue\r\n    for(var j=0,jLen=hostMetric.services.length;j<jLen;++j){\r\n        if (hostMetric.services[j].status == \'OK\'){\r\n            ++ok;\r\n        }else{\r\n            ++error;\r\n        }\r\n    }\r\n    metrics.push({host:hostMetric.name,ok:ok,error:error});\r\n}\r\nvar pageSize=5;\r\ndivMetric.datagrid({\r\n    //title:\'${title}\',\r\n    fitColumns: true,\r\n    rownumbers: true,\r\n    singleSelect: true,\r\n    remoteSort:false,\r\n    sortName:\"error\",\r\n    sortOrder:\"desc\",\r\n    pagination: pageSize < metrics.length,\r\n    pageSize:pageSize,\r\n    pageList: getPageList(pageSize),\r\n    columns:[[\r\n        {field:\'host\',title:\'主机\',align:\'center\',halign:\'center\',sortable:\"true\"},\r\n        {field:\'ok\',title:\'正常服务数\',align:\'center\',halign:\'center\',sortable:\"true\"},\r\n        {field:\'error\',title:\'异常服务数\',align:\'center\',halign:\'center\',sortable:\"true\",styler:function (value,row,index){if (value) return \'background-color:\' + colorError+ \';color:white\';}}\r\n    ]],\r\n    data:metrics\r\n}).datagrid(\'clientPaging\');', '1');
INSERT INTO `T_WEB_METRIC_TEMPLATE` (`TEMPLATE_ID`, `TEMPLATE_NAME`, `TEMPLATE_CONTENT`, `TEMPLATE_SCRIPT`, `IS_VALID`) VALUES (5, '主机信息', NULL, 'var propName=\'${request.propName}\',propTitle=\'${request.propTitle}\',filter=\'${request.filter}\',hostTypes = eval(\'${hostType.metrics}\'),hostInfos = eval(\'${hostInfo.metrics}\');\r\nvar filters = filter.split(\"|\",2),filterType=filterValue=undefined;\r\nif (filters.length == 2){\r\n    filterType = filters[0];\r\n    filterValue = filters[1];\r\n}\r\nif (!isArray(hostTypes) || hostTypes.length == 0 || !hostTypes[0].value){\r\n    divMetric.html(\'<label>加载失败！</label>\');\r\n    return;\r\n}\r\nhostTypes = hostTypes[0].value;\r\nif (!isArray(hostInfos) || hostInfos.length == 0 || !hostInfos[0].value){\r\n    divMetric.html(\'<label>加载失败！</label>\');\r\n    return;\r\n}\r\nhostInfos = hostInfos[0].value;\r\nvar datas=[],merges=[],hostClusters = {},dataIndex = 0,url=apiUrlPrefix + \"/api/v1/ops/cluster/metric\";\r\nfor (var i = 0, iLen = hostTypes.length; i < iLen; i++) {\r\n    var hostType = hostTypes[i];\r\n    if (filterType && filterValue != hostType[filterType]) continue;\r\n    hostClusters[hostTypes[i].hostname] = hostType.cluster;\r\n}\r\nfor (var i = 0,iLen = hostInfos.length; i < iLen; i++) {\r\n    var hostInfo = hostInfos[i],disks=hostInfo.disk.split(\":\"),params = {c:hostClusters[hostInfo.hostname],h:hostInfo.hostname};\r\n    if (!params.c) continue;\r\n    merges.push({index:dataIndex,rowspan:disks.length});\r\n    for (var j = 0, jLen = disks.length; j < jLen; j++) {\r\n        var diskname = disks[j],diskused = getLatestGangliaMetricValue(url,diskname + \"-disk_used\",params),\r\n            disktotal = getLatestGangliaMetricValue(url,diskname + \"-disk_total\",params),diskused = diskused ? diskused:0,disktotal = disktotal ? disktotal:0;\r\n        datas.push({name:hostInfo.hostname,cpu:hostInfo.cpu,mem:hostInfo.mem,disk:diskname,diskfree:100-diskused,diskused:diskused,disktotal:disktotal});\r\n        ++dataIndex;\r\n    }\r\n}\r\nfunction onLoadSuccess(data){\r\n    for(var i=0; i<merges.length; i++){\r\n        $(this).datagrid(\'mergeCells\',{\r\n            index: merges[i].index,\r\n            field: \'name\',\r\n            rowspan: merges[i].rowspan\r\n        }).datagrid(\'mergeCells\',{\r\n            index: merges[i].index,\r\n            field: \'cpu\',\r\n            rowspan: merges[i].rowspan\r\n        }).datagrid(\'mergeCells\',{\r\n            index: merges[i].index,\r\n            field: \'mem\',\r\n            rowspan: merges[i].rowspan\r\n        });\r\n    }\r\n}\r\nvar pageSize=5;\r\ndivMetric.datagrid({\r\n    //title:\'${title}\',\r\n    fitColumns: true,\r\n    rownumbers: true,\r\n    singleSelect: true,\r\n    remoteSort:false,\r\n    //sortName:\"error\",\r\n    //sortOrder:\"desc\",\r\n    //pagination: pageSize < datas.length,\r\n    //pageSize:pageSize,\r\n    pageSize:datas.length,\r\n    pageList: getPageList(pageSize),\r\n    onLoadSuccess: onLoadSuccess,\r\n    columns:[[\r\n        {field:\'name\',title:\'主机\',align:\'center\',halign:\'center\',formatter:function(value){return \'<a href=\"#\" onclick=\"javascript:window.top.createPageById(39,\\\\\'&p=h:\' + value+ \'\\\\\');\">\' + value + \'</a>\';}},\r\n        {field:\'cpu\',title:\'CPU\',align:\'center\',halign:\'center\'},\r\n        {field:\'mem\',title:\'内存\',align:\'center\',halign:\'center\'},\r\n        {field:\'disk\',title:\'磁盘块\',align:\'center\',halign:\'center\'},\r\n        {field:\'disktotal\',title:\'总空间(GB)\',align:\'center\',halign:\'center\',formatter: function(value,row,index){return storageSpaceAdapt(value,\"G\").value;}},\r\n        {field:\'diskused\',title:\'已用空间(%)\',align:\'center\',halign:\'center\',formatter: function(value,row,index){return value + \"%\";}}\r\n    ]],\r\n    data:datas\r\n}).datagrid(\'clientPaging\');', '1');
INSERT INTO `T_WEB_METRIC_TEMPLATE` (`TEMPLATE_ID`, `TEMPLATE_NAME`, `TEMPLATE_CONTENT`, `TEMPLATE_SCRIPT`, `IS_VALID`) VALUES (6, '指标报表（图表）', '', 'var colorOk=\'${config.COLOR_OK}\',colorNormal=\'${config.COLOR_NORMAL}\',colorWarn=\'${config.COLOR_WARN}\',colorError=\'${config.COLOR_ERROR}\',echartType=\'${request.type}\',metricName=\'${request.m}\',threshold=toDecimal(\'${request.threshold}\'),thresholdUnit=\'${request.thresholdUnit}\',metricReport=eval(\'${metricReport.metrics}\');\r\nvar filters=[];\r\nif (!isArray(metricReport) || metricReport.length == 0 || !metricReport[0].value){\r\n    divMetric.html(\'<label>加载失败！</label>\');\r\n    return;\r\n}\r\nmetricReport = metricReport[0].value;\r\n\r\nif(echarts){\r\n	var datas = getEchartsReportDatas(metricName,metricReport,echartType);\r\n    mychart = createEcharts(echarts,divMetric.attr(\"id\"),datas,filters,metricName,echartType,threshold,colorOk,colorError);\r\n}', '1');
INSERT INTO `T_WEB_METRIC_TEMPLATE` (`TEMPLATE_ID`, `TEMPLATE_NAME`, `TEMPLATE_CONTENT`, `TEMPLATE_SCRIPT`, `IS_VALID`) VALUES (7, '服务状态概览图', '', 'var colorOk=\'${config.COLOR_OK}\',colorNormal=\'${config.COLOR_NORMAL}\',colorWarn=\'${config.COLOR_WARN}\',colorError=\'${config.COLOR_ERROR}\',filter=\'${request.filter}\',hostMetrics = eval(\'${hostService.metrics}\'),datas=[];\r\nif (!isArray(hostMetrics) || hostMetrics.length == 0 || !hostMetrics[0].value){\r\n    divMetric.html(\'<label>加载失败！</label>\');\r\n    return;\r\n}\r\nhostMetrics = hostMetrics[0].value;\r\nvar status={},filters = filter != \'*\' && filter != \'\'?filter.split(\"\\\\|\"):undefined;\r\nfor(var i=0,iLen=hostMetrics.length;i<iLen;++i){\r\n    var hostMetric = hostMetrics[i];\r\n    for(var j=0,jLen=hostMetric.services.length;j<jLen;++j){\r\n        if (!filters || -1 < filters.indexOf(hostMetric.services[j].name)){\r\n            if (!status[hostMetric.services[j].name]){\r\n                status[hostMetric.services[j].name] = {ok:0,warn:0};\r\n            }\r\n            if(\'OK\' == hostMetric.services[j].status){\r\n                status[hostMetric.services[j].name].ok += 1;\r\n            }else{\r\n                status[hostMetric.services[j].name].warn += 1;\r\n            }\r\n        }\r\n    }\r\n}\r\nfor(var name in status){\r\n    datas.push({name:name,ok:status[name].ok,warn:status[name].warn});\r\n}\r\nvar pageSize=100;\r\ndivMetric.datagrid({\r\n    //title:\'${title}\',\r\n    //fitColumns: true,\r\n    rownumbers: false,\r\n    singleSelect: true,\r\n    showHeader:false,\r\n    remoteSort:false,\r\n    sortName:\"warn\",\r\n    sortOrder:\"desc\",\r\n    pagination: pageSize < datas.length,\r\n    pageSize:pageSize,\r\n    pageList: getPageList(pageSize),\r\n    columns:[[\r\n        {field:\'warn\',title:\'\',align:\'center\',halign:\'center\',sortable:\"true\",width:30,\r\n                styler:function (value,row,index){\r\n                    if (row.warn == 0){ return \'background-color:\' + colorOk;}\r\n                    else if (row.ok == 0){return \'background-color:\' + colorError;}\r\n                    else{return \'background-color:\' + colorWarn;}\r\n                },\r\n                formatter: function(value,row,index){return row.ok + \'/\' + (row.ok + row.warn);}\r\n                },\r\n        {field:\'name\',title:\'服务名\',align:\'center\',halign:\'center\',width:110}\r\n    ]],\r\n    data:datas\r\n}).datagrid(\'clientPaging\');', '1');
INSERT INTO `T_WEB_METRIC_TEMPLATE` (`TEMPLATE_ID`, `TEMPLATE_NAME`, `TEMPLATE_CONTENT`, `TEMPLATE_SCRIPT`, `IS_VALID`) VALUES (8, '主机状态概览图', '', 'var colorOk=\'${config.COLOR_OK}\',colorNormal=\'${config.COLOR_NORMAL}\',colorWarn=\'${config.COLOR_WARN}\',colorError=\'${config.COLOR_ERROR}\',filter=\'${request.filter}\',hostTypes = eval(\'${hostType.metrics}\'),hostStatus = eval(\'${hostStatus.metrics}\');\r\nvar types={},hostMetrics={},filters = filter.split(\"|\",2),filterType=filterValue=undefined;\r\nif (!isArray(hostTypes) || hostTypes.length == 0 || !hostTypes[0].value\r\n    || !isArray(hostStatus) || hostStatus.length == 0 || !hostStatus[0].value){\r\n    divMetric.html(\'<label>加载失败！</label>\');\r\n    return;\r\n}\r\nhostTypes = hostTypes[0].value;\r\nhostStatus = hostStatus[0].value;\r\n\r\n\r\nif(echarts){\r\n    for(var i=0,iLen=hostStatus.length;i<iLen;++i){\r\n        var aStatus = hostStatus[i];\r\n        if (!hostMetrics[aStatus.name]){\r\n            hostMetrics[aStatus.name] = aStatus;\r\n        }\r\n    }\r\n    \r\n    if (filters.length == 2){\r\n        filterType = filters[0];\r\n        filterValue = filters[1];\r\n    }\r\n	var titles=[\'正常\',\'异常\',\'手动下线\'],up={value:0,name:titles[0],itemStyle:{normal:{color:colorOk}}},warn={value:0,name:titles[1],itemStyle:{normal:{color:colorError}}},outline={value:0,name:titles[2]},datas = [up,warn,outline],hosts={};\r\n    for(var i=0,iLen=hostTypes.length;i<iLen;++i){\r\n        var hostType = hostTypes[i];\r\n        if (filterType && filterValue != hostType[filterType]) continue;\r\n		if (hosts[hostType.hostname])continue;\r\n		hosts[hostType.hostname] = 1;\r\n        var aStatus = hostMetrics[hostType.hostname];\r\n        if (!aStatus){\r\n            outline.value += 1;\r\n        }else if (aStatus.status == \'UP\'){\r\n            up.value += 1;\r\n        }else{\r\n            down.value += 1;\r\n        }\r\n    }\r\n    var option = getOptionWithPie(echarts, undefined, datas, titles);\r\n    mychart = doCreateChart(echarts,divMetric.attr(\"id\"),option);\r\n}', '1');
INSERT INTO `T_WEB_METRIC_TEMPLATE` (`TEMPLATE_ID`, `TEMPLATE_NAME`, `TEMPLATE_CONTENT`, `TEMPLATE_SCRIPT`, `IS_VALID`) VALUES (9, 'HDFS状态', NULL, 'var colorOk=\'${config.COLOR_OK}\',colorNormal=\'${config.COLOR_NORMAL}\',colorWarn=\'${config.COLOR_WARN}\',colorError=\'${config.COLOR_ERROR}\',hdfsStatus = eval(\'${hdfsStatus.metrics}\');\r\nif (!isArray(hdfsStatus) || hdfsStatus.length == 0 || !hdfsStatus[0].value){\r\n    divMetric.html(\'<label>加载失败！</label>\');\r\n    return;\r\n}\r\n\r\nif(echarts){\r\n    var Used = Total = 0;\r\n    for(var i = 0,iLen = hdfsStatus.length; i < iLen; i++){\r\n        if (\'used\' == hdfsStatus[i].title){\r\n            Used = hdfsStatus[i].value;\r\n        }else if (\'total\' == hdfsStatus[i].title){\r\n            Total = hdfsStatus[i].value;\r\n        }\r\n    }\r\n	var titles=[\'已用\',\'剩余\'],used={value:Used,name:titles[0],itemStyle:{normal:{color:colorNormal}}},free={value:(Total-Used),name:titles[1],itemStyle:{normal:{color:colorOk}}},datas = [used,free];\r\n    \r\n    var option = getOptionWithPie(echarts, undefined, datas, titles,byteTipFormatter,undefined,undefined,byteFormatter);\r\n    mychart = doCreateChart(echarts,divMetric.attr(\"id\"),option);\r\n}', '1');
INSERT INTO `T_WEB_METRIC_TEMPLATE` (`TEMPLATE_ID`, `TEMPLATE_NAME`, `TEMPLATE_CONTENT`, `TEMPLATE_SCRIPT`, `IS_VALID`) VALUES (10, 'Hadoop集群队列状态', '', 'var datas = eval(\'${queueStatus.metrics}\'),values=[];\r\nif (!isArray(datas) || datas.length == 0 || !datas[0].value){\r\n    divMetric.html(\'<label>加载失败！</label>\');\r\n    return;\r\n}\r\ndatas = datas[0].value;\r\nvalues.push(\r\n{id:1,\r\n name:datas.queueName,\r\n cluster_vCores:datas.clusterResources.vCores,\r\n cluster_memory:datas.clusterResources.memory,\r\n max_vCores:datas.maxResources.vCores,\r\n max_memory:datas.maxResources.memory,\r\n min_vCores:datas.minResources.vCores,\r\n min_memory:datas.minResources.memory,\r\n used_vCores:datas.usedResources.vCores,\r\n used_memory:datas.usedResources.memory,\r\n maxApps:datas.maxApps,\r\n schedulingPolicy:datas.schedulingPolicy,\r\n children:[]\r\n });\r\nif (datas.childQueues && datas.childQueues.length){\r\n    for(var i=0,iLen = datas.childQueues.length;i<iLen;i++){\r\n        var aData = datas.childQueues[i];\r\n        values[0].children.push(\r\n        {id:11 + i,\r\n         _parentId:1,\r\n         name:aData.queueName,\r\n         cluster_vCores:aData.clusterResources.vCores,\r\n         cluster_memory:aData.clusterResources.memory,\r\n         max_vCores:aData.maxResources.vCores,\r\n         max_memory:aData.maxResources.memory,\r\n         min_vCores:aData.minResources.vCores,\r\n         min_memory:aData.minResources.memory,\r\n         used_vCores:aData.usedResources.vCores,\r\n         used_memory:aData.usedResources.memory,\r\n         maxApps:aData.maxApps,\r\n         schedulingPolicy:aData.schedulingPolicy\r\n         });\r\n    }\r\n}\r\nfunction formatProgressCore(value,row,index){\r\n    return formatProgress(toDecimal((100 * row.used_vCores)/row.max_vCores,2));\r\n}\r\nfunction formatProgressMemory(value,row,index){\r\n    return formatProgress(toDecimal((100 * row.used_memory)/row.max_memory,2));\r\n}\r\nvar pageSize=15;\r\ndivMetric.treegrid({\r\n    //title:\'${title}\',\r\n    //fitColumns: true,\r\n    //rownumbers: true,\r\n    //singleSelect: true,\r\n    //remoteSort:false,\r\n    lines: true,\r\n    idField:\'id\',\r\n    treeField:\'name\',\r\n    //pagination: pageSize < values.length,\r\n    //pageSize:pageSize,\r\n    //pageList: getPageList(pageSize),\r\n    columns:[[\r\n        {field:\'name\',title:\'队列名\'},\r\n        {field:\'cluster_vCores\',title:\'集群核数\',align:\'center\',halign:\'center\'},\r\n        {field:\'cluster_memory\',title:\'集群内存\',align:\'center\',halign:\'center\'},\r\n        {field:\'max_vCores\',title:\'最大核数\',align:\'center\',halign:\'center\'},\r\n        {field:\'max_memory\',title:\'最大内存\',align:\'center\',halign:\'center\'},\r\n        {field:\'min_vCores\',title:\'最小核数\',align:\'center\',halign:\'center\'},\r\n        {field:\'min_memory\',title:\'最小内存\',align:\'center\',halign:\'center\'},\r\n        {field:\'used_vCores\',title:\'已用核数\',align:\'center\',halign:\'center\',formatter:formatProgressCore},\r\n        {field:\'used_memory\',title:\'已用内存\',align:\'center\',halign:\'center\',formatter:formatProgressMemory},\r\n        {field:\'maxApps\',title:\'最大APP数\',align:\'center\',halign:\'center\'},\r\n        {field:\'schedulingPolicy\',title:\'策略\',align:\'center\',halign:\'center\'}\r\n    ]],\r\n    data:values\r\n});', '1');
INSERT INTO `T_WEB_METRIC_TEMPLATE` (`TEMPLATE_ID`, `TEMPLATE_NAME`, `TEMPLATE_CONTENT`, `TEMPLATE_SCRIPT`, `IS_VALID`) VALUES (11, 'Hadoop集群任务状态', NULL, 'var colorOk=\'${config.COLOR_OK}\',colorNormal=\'${config.COLOR_NORMAL}\',colorWarn=\'${config.COLOR_WARN}\',colorError=\'${config.COLOR_ERROR}\',metrics = eval(\'${appStatus.metrics}\');\r\nif (!isArray(metrics) || metrics.length == 0 || !metrics[0].value){\r\n    divMetric.html(\'<label>加载失败！</label>\');\r\n    return;\r\n}\r\nmetrics = metrics[0].value;\r\nif(echarts){\r\n    var datas = [],titles=[],itemStyles = {FINISHED:{normal:{color:colorOk}}};\r\n    for(var i = 0,iLen = metrics.length; i < iLen; i++){\r\n        var data = {value:metrics[i].count,name:metrics[i].state};\r\n        if (itemStyles[metrics[i].state]){\r\n            data.itemStyle = itemStyles[metrics[i].state];\r\n        }\r\n        datas.push(data);\r\n        titles.push(metrics[i].state);\r\n    }\r\n	\r\n    var option = getOptionWithPie(echarts, undefined, datas, titles,byteTipFormatter, undefined, undefined, valueFormatter, undefined,undefined,[\'50%\',\'65%\']);\r\n    mychart = doCreateChart(echarts,divMetric.attr(\"id\"),option);\r\n}', '1');
INSERT INTO `T_WEB_METRIC_TEMPLATE` (`TEMPLATE_ID`, `TEMPLATE_NAME`, `TEMPLATE_CONTENT`, `TEMPLATE_SCRIPT`, `IS_VALID`) VALUES (12, 'Hadoop任务状态列表', NULL, 'var colorOk=\'${config.COLOR_OK}\',colorNormal=\'${config.COLOR_NORMAL}\',colorWarn=\'${config.COLOR_WARN}\',colorError=\'${config.COLOR_ERROR}\',datas = eval(\'${appStatusList.metrics}\');\r\nif (!isArray(datas) || datas.length == 0 || !datas[0].value){\r\n    divMetric.html(\'<label>加载失败！</label>\');\r\n    return;\r\n}\r\ndatas = datas[0].value;\r\nvar pageSize=5;\r\nwindow.showJobDetail = function(appId){\r\n    var jobId = appId.replace(\'application_\',\'job_\');\r\n    window.top.createPageById(28,\"&p=appid:\" + appId + \",jobid:\" + jobId);\r\n}\r\ndivMetric.datagrid({\r\n    //title:\'${title}\',\r\n    fitColumns: true,\r\n    rownumbers: true,\r\n    singleSelect: true,\r\n    remoteSort:false,\r\n    //sortName:\"status\",\r\n    //sortOrder:\"asc\",\r\n    pagination: pageSize < datas.length,\r\n    pageSize:pageSize,\r\n    pageList: getPageList(pageSize),\r\n    columns:[[\r\n        {field:\'id\',title:\'任务编号\',align:\'center\',halign:\'center\',sortable:\"true\",formatter:function(value,row){ if(row.applicationType != \'MAPREDUCE\') return value; else return \"<a href=\'#\' onclick=\'javascript:showJobDetail(\\\\\\\"\" +value+ \"\\\\\\\");\'>\" + value + \"</a>\";}},\r\n        {field:\'name\',title:\'任务名称\',align:\'center\',halign:\'center\',sortable:\"true\"},\r\n        {field:\'queue\',title:\'所在队列\',align:\'center\',halign:\'center\',sortable:\"true\"},\r\n        {field:\'user\',title:\'归属用户\',align:\'center\',halign:\'center\',sortable:\"true\"},\r\n        {field:\'state\',title:\'任务状态\',align:\'center\',halign:\'center\',sortable:\"true\"},\r\n        {field:\'finalStatus\',title:\'最终状态\',align:\'center\',halign:\'center\'},\r\n        {field:\'startedTime\',title:\'开始时间\',align:\'left\',halign:\'center\',formatter:function(value){return new Date(value).format(\'yyyy-MM-dd HH:mm:ss\');}},\r\n        {field:\'finishedTime\',title:\'结束时间\',align:\'left\',halign:\'center\',formatter:function(value){return new Date(value).format(\'yyyy-MM-dd HH:mm:ss\');}},\r\n        {field:\'elapsedTime\',title:\'耗时\',align:\'left\',halign:\'center\',formatter:function(value){return toDecimal(value/1000,2);}},\r\n        {field:\'applicationType\',title:\'任务类型\',align:\'left\',halign:\'center\',formatter:function(value){if (value == \'MAPREDUCE\') return \'<a href=\"#\" onclick=\"javascript:window.top.createPageById(29);\">\' + value + \'</a>\';else return \'\';}}\r\n    ]],\r\n    data:datas\r\n}).datagrid(\'clientPaging\');', '1');
INSERT INTO `T_WEB_METRIC_TEMPLATE` (`TEMPLATE_ID`, `TEMPLATE_NAME`, `TEMPLATE_CONTENT`, `TEMPLATE_SCRIPT`, `IS_VALID`) VALUES (13, 'MR任务状态', NULL, 'var colorOk=\'${config.COLOR_OK}\',colorNormal=\'${config.COLOR_NORMAL}\',colorWarn=\'${config.COLOR_WARN}\',colorError=\'${config.COLOR_ERROR}\',datas = eval(\'${jobStatus.metrics}\');\r\nif (!isArray(datas) || datas.length == 0 || !datas[0].value){\r\n    divMetric.html(\'<label>加载失败！</label>\');\r\n    return;\r\n}\r\ndatas = datas[0].value;\r\nwindow.showJobDetail = function(jobId){\r\n    var appId = jobId.replace(\'job_\',\'application_\');\r\n    window.top.createPageById(28,\"&p=appid:\" + appId + \",jobid:\" + jobId);\r\n}\r\nvar pageSize=5;\r\ndivMetric.datagrid({\r\n    //title:\'${title}\',\r\n    fitColumns: true,\r\n    rownumbers: true,\r\n    singleSelect: true,\r\n    remoteSort:false,\r\n    //sortName:\"status\",\r\n    //sortOrder:\"asc\",\r\n    pagination: pageSize < datas.length,\r\n    pageSize:pageSize,\r\n    pageList: getPageList(pageSize),\r\n    columns:[[\r\n        {field:\'id\',title:\'任务编号\',align:\'center\',halign:\'center\',sortable:\"true\",formatter:function(value){ return \"<a href=\'#\' onclick=\'javascript:showJobDetail(\\\\\\\"\" +value+ \"\\\\\\\");\'>\" + value + \"</a>\";}},\r\n        {field:\'name\',title:\'任务名称\',align:\'center\',halign:\'center\',sortable:\"true\"},\r\n        {field:\'queue\',title:\'所在队列\',align:\'center\',halign:\'center\',sortable:\"true\"},\r\n        {field:\'user\',title:\'归属用户\',align:\'center\',halign:\'center\',sortable:\"true\"},\r\n        {field:\'state\',title:\'任务状态\',align:\'center\',halign:\'center\',sortable:\"true\"},\r\n        {field:\'submitTime\',title:\'提交时间\',align:\'center\',halign:\'center\',formatter:function(value){return new Date(value).format(\'yyyy-MM-dd HH:mm:ss\');}},\r\n        {field:\'startTime\',title:\'开始时间\',align:\'left\',halign:\'center\',formatter:function(value){return new Date(value).format(\'yyyy-MM-dd HH:mm:ss\');}},\r\n        {field:\'finishTime\',title:\'结束时间\',align:\'left\',halign:\'center\',formatter:function(value){return new Date(value).format(\'yyyy-MM-dd HH:mm:ss\');}},\r\n        {field:\'mapsTotal\',title:\'map总数\',align:\'left\',halign:\'center\'},\r\n        {field:\'reducesTotal\',title:\'reduce总数\',align:\'left\',halign:\'center\'},\r\n        {field:\'mapsCompleted\',title:\'map完成数\',align:\'left\',halign:\'center\'},\r\n        {field:\'reducesCompleted\',title:\'reduce完成数\',align:\'left\',halign:\'center\'}\r\n    ]],\r\n    data:datas\r\n}).datagrid(\'clientPaging\');', '1');
INSERT INTO `T_WEB_METRIC_TEMPLATE` (`TEMPLATE_ID`, `TEMPLATE_NAME`, `TEMPLATE_CONTENT`, `TEMPLATE_SCRIPT`, `IS_VALID`) VALUES (14, 'MR任务详情', NULL, 'var colorOk=\'${config.COLOR_OK}\',colorNormal=\'${config.COLOR_NORMAL}\',colorWarn=\'${config.COLOR_WARN}\',colorError=\'${config.COLOR_ERROR}\',datas = eval(\'${jobStatusDetail.metrics}\');\r\nif (!isArray(datas) || datas.length == 0 || !datas[0].value || !datas[0].value.job){\r\n    divMetric.html(\'<label>获取明细失败！</label>\');\r\n    return;\r\n}\r\ndatas = datas[0].value.job;\r\nvar values = [];\r\nfor(var name in datas){\r\n    values.push({name:name,value:datas[name]});\r\n}\r\nvar pageSize=5;\r\ndivMetric.propertygrid({\r\n    data:values\r\n});', '1');
INSERT INTO `T_WEB_METRIC_TEMPLATE` (`TEMPLATE_ID`, `TEMPLATE_NAME`, `TEMPLATE_CONTENT`, `TEMPLATE_SCRIPT`, `IS_VALID`) VALUES (20, '指标报表饼图', NULL, 'var echartType=\'${request.type}\',metricName=\'${request.m}\',threshold=toDecimal(\'${request.threshold}\'),thresholdUnit=\'${request.thresholdUnit}\',normalColor=\'${config.COLOR_NORMAL}\',warnColor=\'${config.COLOR_WARN}\',metricReport=eval(\'${metricReport.metrics}\');\r\nvar filters=[];\r\nif (!isArray(metricReport) || metricReport.length == 0 || !metricReport[0].value){\r\n    divMetric.html(\'<label>加载失败！</label>\');\r\n    return;\r\n}\r\nmetricReport = metricReport[0].value;\r\n\r\nif(echarts){\r\n	var datas = getEchartsReportDatas(metricName,metricReport,echartType),\r\n    mychart = createEcharts(echarts,divMetric.attr(\"id\"),datas,filters,metricName,echartType,threshold,normalColor,warnColor);\r\n}', '1');
INSERT INTO `T_WEB_METRIC_TEMPLATE` (`TEMPLATE_ID`, `TEMPLATE_NAME`, `TEMPLATE_CONTENT`, `TEMPLATE_SCRIPT`, `IS_VALID`) VALUES (22, '主机指标报表（图表）', '', 'var colorOk=\'${config.COLOR_OK}\',colorNormal=\'${config.COLOR_NORMAL}\',colorWarn=\'${config.COLOR_WARN}\',colorError=\'${config.COLOR_ERROR}\',echartType=\'${request.type}\',metricName=\'${request.m}\',threshold=toDecimal(\'${request.threshold}\'),thresholdUnit=\'${request.thresholdUnit}\',metricReport=eval(\'${hostMetricReport.metrics}\');\r\nvar filters=[];\r\nif (!isArray(metricReport) || metricReport.length == 0 || !metricReport[0].value){\r\n    divMetric.html(\'<label>加载失败！</label>\');\r\n    return;\r\n}\r\nmetricReport = metricReport[0].value;\r\n\r\nif(echarts){\r\n	var datas = getEchartsReportDatas(metricName,metricReport,echartType),\r\n    mychart = createEcharts(echarts,divMetric.attr(\"id\"),datas,filters,metricName,echartType,threshold,colorOk,colorError);\r\n}', '1');
INSERT INTO `T_WEB_METRIC_TEMPLATE` (`TEMPLATE_ID`, `TEMPLATE_NAME`, `TEMPLATE_CONTENT`, `TEMPLATE_SCRIPT`, `IS_VALID`) VALUES (23, '主机概述', '', 'var colorOk=\'${config.COLOR_OK}\',colorNormal=\'${config.COLOR_NORMAL}\',colorWarn=\'${config.COLOR_WARN}\',colorError=\'${config.COLOR_ERROR}\',filter=\'${request.filter}\',datas = eval(\'${hostStatus.metrics}\');\r\nif (!isArray(datas) || datas.length == 0 || !datas[0].value){\r\n    divMetric.html(\'<label>加载失败！</label>\');\r\n    return;\r\n}\r\ndatas = datas[0].value;\r\nvar filters = filter.split(\"|\",2),aData=filterType=filterValue=undefined,values=[];\r\nif (filters.length == 2){\r\n    filterType = filters[0];\r\n    filterValue = filters[1];\r\n}\r\nif(!filterType){\r\n    divMetric.html(\'<label>未指定过滤规则</label>\');\r\n    return;\r\n}\r\nfor(var i=0,iLen=datas.length;i<iLen;++i){\r\n	if (datas[i][filterType] == filterValue){\r\n		aData = datas[i];\r\n		break;\r\n	}\r\n}\r\nif (!aData){\r\n    divMetric.html(\'<label>未匹配上数据</label>\');\r\n    return;\r\n}\r\nvalues.push({name:\"主机名\",value:aData[\"name\"]});\r\nvalues.push({name:\"主机IP\",value:aData[\"ip\"]});\r\nvalues.push({name:\"状态\",value:aData[\"status\"]});\r\nvalues.push({name:\"在线时长\",value:aData[\"duration\"]});\r\nvalues.push({name:\"最近检查时间\",value:aData[\"lastCheck\"]});\r\n\r\ndivMetric.propertygrid({\r\n    showHeader:false,fitColumns:true,\r\n    data:values\r\n});', '1');
